# Инструкция по сборке Windows EXE

Эта инструкция поможет вам собрать симулятор WoW Mists of Pandaria Classic в виде исполняемого файла (.exe) для Windows.

## Предварительные требования

Для сборки вам понадобятся следующие инструменты:

1.  **Go (Golang)**: [Скачать Go](https://golang.org/dl/). Рекомендуется версия 1.23 или новее.
2.  **Node.js и npm**: [Скачать Node.js](https://nodejs.org/).
3.  **Git**: [Скачать Git](https://git-scm.com/downloads).

## Самый простой способ сборки (Windows PowerShell)

Я добавил специальный скрипт `build_windows.ps1`, который автоматически выполняет все необходимые шаги: генерирует файлы протоколов, собирает интерфейс (UI) и компилирует сервер в один .exe файл.

1. Откройте папку проекта.
2. Правой кнопкой мыши на пустом месте -> **Open in Terminal** (или запустите **PowerShell** и перейдите в папку через `cd`).
3. Выполните команду:
   ```powershell
   .\build_windows.ps1
   ```
   *Примечание: Если PowerShell запрещает запуск скриптов, выполните сначала: `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process`*

4. После завершения в корневой папке появится файл `wowsimmop.exe`.

## Экспорт данных для нейросети

Для анализа ротации и обучения нейросетей добавлена специальная функция экспорта.

### Как использовать:
1. Запустите собранный `wowsimmop.exe`.
2. Настройте вашего персонажа (шмот, таланты) и APL ротацию.
3. В верхнем меню выберите **Export** -> **Neural Network**.
4. В появившемся окне нажмите кнопку **Запустить и Экспортировать (Run and Export)**.
5. Симулятор автоматически выполнит **одну итерацию боя** с максимально подробным логированием.
6. Вам будет предложено скачать файл `wowsims_neural_net.json`.

### Что внутри файла:
- **`request`**: Полные настройки симуляции (шмот, баффы, враг и сама APL ротация).
- **`result.logs`**: Весь текстовый лог боя. Каждое событие (каст, урон, бафф, ресурс) имеет метку времени.
- **APL Decisions**: В логе теперь отображаются записи вида `[APL] Index X: Cast Spell ...`, что позволяет нейросети понять, какое именно правило ротации сработало в данный момент боя.

## Устранение неполадок

### Ошибка TS2345 при сборке UI
Если при сборке возникают ошибки TypeScript, убедитесь, что вы используете последнюю версию кода. Я исправил основные конфликты типов и циклические зависимости, которые могли мешать сборке на Windows.

### Ошибки при генерации Protobuf
Для сборки серверной части (Go) требуются файлы `.pb.go`. Если скрипт сообщает, что `protoc-gen-go` не найден, вам нужно:
1. Установить плагин:
   ```bash
   go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
   ```
2. Убедиться, что папка с бинарными файлами Go добавлена в переменную **PATH**. Обычно это `%USERPROFILE%\go\bin`.
3. Если вы не можете установить плагин, вы не сможете собрать новый `.exe`.

### Ошибка "highs.wasm not found"
Если вы видите предупреждение про `highs.wasm`, это нормально для ZIP-архивов с исходным кодом. Сборка продолжится, но функция "Reforge Optimizer" не будет работать.

### Ошибка "no required module provides package .../proto"
Это происходит, если Шаг 2 (генерация протоколов) завершился с ошибкой. Убедитесь, что у вас установлен `protoc` или исправно работает `npx protoc`.

---

## Ручная сборка (для продвинутых)

Если вы предпочитаете использовать `make` (например, через Git Bash или WSL):

1. `make proto` — генерация кода из .proto файлов.
2. `make dist/mop` — сборка UI.
3. `make wowsimmop-windows.exe` — сборка финального файла.
